<!doctype html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <title>JobBoard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
 

   
</head>
<body>
    <h1>JobBoard</h1>
    <div class="muted">Bu sayfadan API’yi doğrudan test edebilirsin. Swagger’a gerek yok.</div>

    <div class="row" style="margin-top:12px;">
        <div class="col">
            <div class="card">
                <h3>Yeni İş İlanı</h3>
                <label for="title">Başlık</label>
                <input id="title" placeholder="Örn: Junior .NET Developer" />
                <label for="desc">Açıklama</label>
                <textarea id="desc" placeholder="Kısa açıklama"></textarea>
                <button onclick="createJob()">Oluştur</button>
                <div id="createJobMsg" class="muted"></div>
            </div>
        </div>

        <div class="col">
            <div class="card">
                <h3>İş İlanları</h3>
                <button onclick="loadJobs()">Yenile</button>
                <ul id="jobs" class="muted" style="margin-top:8px;"></ul>
                <div id="jobsInfo" class="muted"></div>
            </div>
        </div>
    </div>

    <div class="card" style="margin-top:16px;">
        <h3>Seçili İlan’a Başvur</h3>
        <label for="jobId">Job Id</label>
        <input id="jobId" type="number" placeholder="Örn: 1" />
        <label for="appName">Ad Soyad</label>
        <input id="appName" placeholder="Örn: Ali Veli" />
        <label for="appEmail">E‑posta</label>
        <input id="appEmail" placeholder="ali@example.com" />
        <button onclick="apply()">Başvur</button>
        <div id="applyMsg" class="muted"></div>
    </div>

    <div class="card" style="margin-top:16px;">
        <h3>Başvurular (Seçili İş)</h3>
        <button onclick="loadApplications()">Yenile</button>
        <div id="appsInfo" class="muted" style="margin-top:8px;">Henüz iş seçilmedi.</div>
        <ul id="applications" class="muted" style="margin-top:8px;"></ul>
    </div>

    <div id="error" class="err" style="margin-top:12px;"></div>

    <script>
        const api = ""; // Aynı origin
        let selectedJobId = null;

        function showErr(msg) { document.getElementById("error").textContent = msg; }
        function clearErr() { document.getElementById("error").textContent = ""; }

        async function createJob() {
            clearErr();
            document.getElementById("createJobMsg").textContent = "";
            const title = document.getElementById("title").value.trim();
            const description = document.getElementById("desc").value.trim();
            if (!title || !description) { showErr("Başlık ve açıklama zorunlu."); return; }
            try {
                const res = await fetch(api + "/api/Jobs", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ title, description })
                });
                if (!res.ok) { showErr("Job oluşturulamadı: " + res.status + " " + res.statusText); return; }
                document.getElementById("createJobMsg").innerHTML = "<span class='ok'>Oluşturuldu.</span>";
                document.getElementById("title").value = "";
                document.getElementById("desc").value = "";
                await loadJobs();
            } catch (e) { showErr(e.message); }
        }

        async function loadJobs() {
            clearErr();
            const ul = document.getElementById("jobs");
            const info = document.getElementById("jobsInfo");
            ul.innerHTML = "Yükleniyor...";
            info.textContent = "";
            try {
                const res = await fetch(api + "/api/Jobs");
                if (!res.ok) { ul.innerHTML = ""; showErr("Jobs alınamadı: " + res.status + " " + res.statusText); return; }
                const data = await res.json();
                if (!Array.isArray(data) || data.length === 0) {
                    ul.innerHTML = "";
                    info.textContent = "Kayıt yok.";
                    return;
                }
                ul.innerHTML = "";
                for (const j of data) {
                    const li = document.createElement("li");
                    li.className = "job-item" + (selectedJobId === j.id ? " active" : "");
                    li.textContent = "#" + j.id + " — " + j.title;
                    li.onclick = () => selectJob(j.id);
                    ul.appendChild(li);
                }
            } catch (e) { ul.innerHTML = ""; showErr(e.message); }
        }

        function selectJob(id) {
            selectedJobId = id;
            document.getElementById("jobId").value = id;
            document.getElementById("appsInfo").textContent = "Job #" + id + " başvuruları";
            // aktif vurgusunu güncelle
            document.querySelectorAll(".job-item").forEach(el => {
                el.classList.toggle("active", el.textContent.startsWith("#" + id));
            });
            loadApplications();
        }

        async function apply() {
            clearErr();
            document.getElementById("applyMsg").textContent = "";
            const id = parseInt(document.getElementById("jobId").value, 10);
            const applicantName = document.getElementById("appName").value.trim();
            const applicantEmail = document.getElementById("appEmail").value.trim();
            if (!id || !applicantName || !applicantEmail) { showErr("Tüm alanlar zorunlu."); return; }
            try {
                const res = await fetch(api + `/api/Jobs/${id}/apply`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ applicantName, applicantEmail })
                });
                if (!res.ok) { showErr("Başvuru başarısız: " + res.status + " " + res.statusText); return; }
                document.getElementById("applyMsg").innerHTML = "<span class='ok'>Başvuru alındı.</span>";
                document.getElementById("appName").value = "";
                document.getElementById("appEmail").value = "";
                if (selectedJobId === id) { loadApplications(); }
            } catch (e) { showErr(e.message); }
        }

        async function loadApplications() {
            clearErr();
            if (!selectedJobId) {
                document.getElementById("appsInfo").textContent = "İş seçiniz.";
                document.getElementById("applications").innerHTML = "";
                return;
            }
            const ul = document.getElementById("applications");
            ul.innerHTML = "Yükleniyor...";
            try {
                const res = await fetch(api + `/api/Jobs/${selectedJobId}/applications`);
                if (!res.ok) {
                    ul.innerHTML = "";
                    if (res.status === 404) {
                        document.getElementById("appsInfo").textContent = "Başvurular endpoint'i henüz eklenmemiş olabilir.";
                    } else {
                        showErr("Başvurular alınamadı: " + res.status + " " + res.statusText);
                    }
                    return;
                }
                const data = await res.json();
                if (!Array.isArray(data) || data.length === 0) {
                    ul.innerHTML = "<span class='muted'>Başvuru yok.</span>";
                    return;
                }
                ul.innerHTML = "";
                for (const a of data) {
                    const li = document.createElement("li");
                    li.innerHTML = `#${a.id} — ${a.applicantName} <span class="muted">(${a.applicantEmail})</span>`;
                    ul.appendChild(li);
                }
            } catch (e) { ul.innerHTML = ""; showErr(e.message); }
        }

        window.addEventListener("load", loadJobs);
    </script>
</body>
</html>